:root{
  --bg:#060d13;
  --bg-2:#071923;
  --card:#0a141d;
  --muted:#9aa3b2;
  --text:#e6eef6;

  --accent:#32d6a6;
  --accent-2:#2bb089;
  --accent-3:#61a0ff;

  /* Layout */
  --container-max: 1120px;
  --sidebar-w: 240px;
  --content-max: 780px;
  --msg-max: 100%;

  --r-lg: 10px;
  --r-md: 8px;
  --r-sm: 6px;
  --space-1: 4px;
  --space-2: 6px;
  --space-3: 8px;
  --space-4: 10px;
  --space-5: 12px;

  /* Lines/borders */
  --glass: rgba(255,255,255,0.035);
  --glass-2: rgba(255,255,255,0.02);
  --border: rgba(255,255,255,0.07);
  --ring: color-mix(in oklab, var(--accent) 60%, white 0%);

  --shadow-1: 0 0 0 1px var(--border), 0 6px 16px rgba(0,0,0,0.25);
  --shadow-2: 0 0 0 1px var(--border), 0 16px 28px rgba(0,0,0,0.35);

  --font: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  --fs-base: 15px;

  --g-hero: radial-gradient(900px 600px at 8% -10%, rgba(97,160,255,0.10), transparent 60%),
            radial-gradient(700px 500px at 92% 12%, rgba(50,214,166,0.10), transparent 60%),
            linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
  --g-logo: linear-gradient(180deg, #0b1320, #0a141d);
  --g-send: linear-gradient(180deg, var(--accent), var(--accent-2));
}

@media (prefers-color-scheme: light){
  :root[data-theme="light"]{
    --bg:#f6f9fb; --bg-2:#eaf1f6; --card:#ffffff;
    --text:#0f141a; --muted:#526275;
    --glass: rgba(0,0,0,0.03); --glass-2: rgba(0,0,0,0.015); --border: rgba(0,0,0,0.08);
    --shadow-1: 0 0 0 1px var(--border), 0 8px 16px rgba(0,0,0,0.08);
    --shadow-2: 0 0 0 1px var(--border), 0 18px 32px rgba(0,0,0,0.12);
    --g-hero: radial-gradient(900px 600px at 8% -10%, rgba(97,160,255,0.14), transparent 60%),
              radial-gradient(700px 500px at 92% 12%, rgba(50,214,166,0.14), transparent 60%),
              linear-gradient(180deg, var(--bg) 0%, var(--bg-2) 100%);
  }
}

*{box-sizing:border-box}
html,body{height:100%}
html{font-family:var(--font); font-size: var(--fs-base)}
body{
  margin:0; color:var(--text);
  background:var(--g-hero);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; text-rendering:optimizeLegibility;
}

:focus-visible{ outline: 2px solid var(--ring); outline-offset: 2px; border-radius: 6px }

/* Scrollbars */
*{ scrollbar-width: thin; scrollbar-color: rgba(255,255,255,0.25) transparent }
*::-webkit-scrollbar{height:10px;width:10px}
*::-webkit-scrollbar-track{background:transparent}
*::-webkit-scrollbar-thumb{
  background:linear-gradient(180deg, rgba(97,160,255,0.5), rgba(50,214,166,0.5));
  border-radius:999px; border:2px solid transparent; background-clip: padding-box;
}

.skip-link{ position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden }
.skip-link:focus{
  left:12px;top:12px;width:auto;height:auto;padding:6px 8px;border-radius:8px;
  background:var(--card);box-shadow:var(--shadow-1);z-index:1000;
}

.app{
  display:flex; gap: var(--space-4);
  width: min(var(--container-max), 96vw);
  margin: 18px auto;
}

.sidebar{
  width: var(--sidebar-w);
  min-width: 200px; max-width: 360px;
  background:linear-gradient(180deg, var(--glass), var(--glass-2));
  backdrop-filter: blur(8px);
  border-radius: var(--r-lg);
  padding: var(--space-4);
  border:1px solid var(--border);
  display:flex;flex-direction:column;gap: var(--space-3);
  box-shadow:var(--shadow-1);
  position: sticky; top: 18px; align-self: flex-start; max-height: calc(100vh - 36px); overflow:auto;
}
.brand{display:flex;align-items:center;gap: var(--space-3)}
.logo{
  width:36px;height:36px;border-radius:8px;
  background:var(--g-logo);
  display:flex;align-items:center;justify-content:center;
  font-weight:700;color:var(--accent);
  border:1px solid var(--border);
}
.brand-title{ font-size:0.98rem; margin:0; letter-spacing:0.2px }

.section{margin-top: var(--space-2)}
.section-title{font-size:0.85rem;color:var(--muted);margin-bottom: var(--space-2)}

.sessions-header{display:flex;align-items:center;justify-content:space-between}
.sessions-actions .btn.small{padding:4px 8px;font-size:0.85rem}

.sessions-search input{
  width:100%;padding:8px 10px;border-radius:8px;
  border:1px solid var(--border);
  background:rgba(255,255,255,0.03);
  color:inherit;outline:none;
}
.sessions-search input:focus{
  border-color: color-mix(in oklab, var(--accent) 40%, transparent 60%);
  box-shadow: 0 0 0 3px rgba(50,214,166,0.12);
}

.sessions-list{ display:flex;flex-direction:column;gap:6px; padding-right:4px; margin-top:6px }
.session-item{
  display:flex;gap:8px;align-items:center;padding:8px;border-radius:8px;
  cursor:pointer;border:1px solid transparent;
  transition: background .12s ease, transform .06s ease, border-color .12s ease;
}
.session-item:hover{ background: rgba(255,255,255,0.04); transform: translateY(-1px) }
.session-item.active{
  background: linear-gradient(90deg, rgba(50,214,166,0.12), rgba(50,214,166,0.04));
  border-color: rgba(50,214,166,0.18);
}
.session-avatar{
  width:34px;height:34px;border-radius:8px;display:flex;align-items:center;justify-content:center;
  background:var(--g-logo);color:var(--accent);font-weight:700;
  border:1px solid var(--border);
  font-size:0.85rem;
}
.session-body{flex:1;min-width:0;display:flex;flex-direction:column;gap:2px}
.session-title{font-weight:600;font-size:0.92rem;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.session-preview{font-size:0.8rem;color:rgba(255,255,255,0.76);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.session-meta{display:flex;gap:6px;align-items:center;font-size:0.72rem;color:var(--muted)}
.session-actions{display:flex;gap:4px;align-items:center;margin-left:4px}
.session-actions button{
  background:transparent;border:0;color:var(--muted);padding:4px;border-radius:6px;cursor:pointer;
}
.session-actions button:hover{color:var(--accent);background:rgba(255,255,255,0.06)}

.chat{flex:1;display:flex;flex-direction:column;gap: var(--space-3);min-width:0}

/* Topbar */
.topbar{
  display:flex;justify-content:space-between;align-items:center;padding:6px 8px;border-radius:8px;
  border:1px solid var(--border);
  background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  box-shadow:var(--shadow-1);
  position:sticky;top:0;z-index:10;backdrop-filter: blur(6px);
}
.conversation-title{display:flex;align-items:center;gap:8px;min-width:0}
.dot{ width:8px;height:8px;border-radius:50%; background:var(--accent) }
.title{font-weight:700;font-size:0.98rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.topbar-actions{display:flex;gap:6px;align-items:center}
.badge{
  background:rgba(255,255,255,0.06);padding:4px 8px;border-radius:999px;font-size:0.8rem;color:var(--muted);
  border:1px solid var(--border);
}
.icon-btn{
  appearance:none;border:0;cursor:pointer;
  width:30px;height:30px;border-radius:8px;
  display:inline-flex;align-items:center;justify-content:center;
  color:#d7e6f1;background:transparent;
  border:1px solid var(--border);
}
.icon-btn:hover{ background:rgba(255,255,255,0.06); color:#ffffff;border-color:rgba(255,255,255,0.18) }
.icon-btn:active{ transform:translateY(1px) }

.chat-box{
  background:transparent; border:0; box-shadow:none;
  padding: 0;
  min-height: 0; max-height: none; overflow: visible;
  display:flex; flex-direction:column; gap: var(--space-3);
}
.empty-state{ text-align:center; color:var(--muted); padding: 18px 0; border-radius:8px }
.empty-emoji{font-size:26px;margin-bottom:6px}
.empty-title{font-weight:700;color:var(--text)}
.empty-sub{margin-top:2px}
.suggestions{display:flex;gap:6px;justify-content:center;margin-top:8px;flex-wrap:wrap}
.chip{
  padding:6px 10px;border-radius:999px;color:inherit;cursor:pointer;
  background:linear-gradient(var(--card), var(--card)) padding-box, linear-gradient(90deg, rgba(97,160,255,0.35), rgba(50,214,166,0.35)) border-box;
  border:1px solid transparent; font-size:0.9rem;
}

/* Message blocks */
.message{
  width:100%;
  max-width: var(--content-max);
  margin: 0 auto;
  padding: 0;
  border:0; background: transparent; border-radius:0;
}
.message + .message{ margin-top: var(--space-3) }

.message.user .md, .message.user > div{
  background: rgba(97,160,255,0.10);
  border:1px solid rgba(97,160,255,0.18);
  border-radius: var(--r-md);
  padding: 10px 12px;
}
.message.assistant .md, .message.assistant > div{
  background: transparent;
  padding: 0;
}

/* Markdown spacing tuned compact */
.message .md{ color:inherit; font-size:1rem; line-height:1.55 }
.message .md :is(p,pre,ul,ol,table,blockquote){ margin: 0.5rem 0 }
.message .md p:first-child{ margin-top:0 }
.message .md p:last-child{ margin-bottom:0 }

/* Headings smaller */
.message .md h1{ font-size:1.2rem; margin: 0.6rem 0 0.35rem }
.message .md h2{ font-size:1.12rem; margin: 0.6rem 0 0.35rem }
.message .md h3{ font-size:1.05rem; margin: 0.5rem 0 0.3rem }

/* Inline code */
.message .md code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  background: rgba(0,0,0,0.25);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:6px; padding:1px 5px; font-size:0.95em
}

/* Code blocks */
.message .md pre{
  position:relative;
  background: rgba(0,0,0,0.28);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:8px;
  padding:10px 12px; overflow:auto;
}
.message .md pre code{ background:transparent;border:0;padding:0;display:block;white-space:pre }

/* Copy button */
.copy-btn{
  position:absolute; top:6px; right:6px;
  padding:3px 6px; font-size:0.78rem; border-radius:6px;
  border:1px solid var(--border); cursor:pointer; color:#cfe7ff;
  background:rgba(255,255,255,0.06);
}

/* Lists, tables, quotes */
.message .md ul{ padding-left:1.15rem; list-style: disc }
.message .md ol{ padding-left:1.15rem; list-style: decimal }
.message .md blockquote{
  margin:0.5rem 0; padding:8px 10px; border-left:3px solid var(--accent);
  background: rgba(50,214,166,0.08); border-radius:8px
}
.message .md table{ border-collapse: separate; border-spacing:0; width:100%; overflow:hidden; border-radius:8px; border:1px solid rgba(255,255,255,0.12) }
.message .md thead th{
  background: rgba(255,255,255,0.06);
  color:#eaf7ff; text-align:left; padding:8px; border-bottom:1px solid rgba(255,255,255,0.12)
}
.message .md td{ padding:8px; border-bottom:1px solid rgba(255,255,255,0.08) }
.message .md tr:last-child td{ border-bottom:0 }

/* Links */
.message .md a{ color:#bdefff; text-decoration:underline }

/* Math */
.message .md .mjx-container{ overflow-x:auto; overflow-y:hidden }

/* Composer */
.controls{
  display:flex;gap: var(--space-3);align-items:flex-end;
  position:sticky;bottom:0;padding-bottom:env(safe-area-inset-bottom);
  background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.15) 70%);
  padding-top: var(--space-2);
}
.input-wrap{flex:1}
#msgInput{
  width:100%;padding:10px 12px;border-radius:12px;
  border:1px solid var(--border);
  background: rgba(255,255,255,0.04);
  color:inherit; resize:none; min-height:38px; max-height:240px;
}
.hint-row{margin-top:4px}
.hint{color:var(--muted);font-size:0.82rem}

.actions-col{display:flex;flex-direction:row;gap:6px}
.btn{
  padding:6px 8px;border-radius:8px;border:1px solid var(--border);
  background: rgba(255,255,255,0.05);
  color:inherit;cursor:pointer; font-size:0.92rem;
}
.btn.ghost{ background:transparent;border-style:dashed }
.btn.small{ font-size:0.85rem; padding:4px 8px }

.send-btn{
  background:var(--g-send);color:#021019;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700;
  letter-spacing:0.1px; box-shadow: 0 6px 14px rgba(50,214,166,0.18), inset 0 1px 0 rgba(255,255,255,0.28);
}

/* Keyboard UI */
.kbd{ background:rgba(255,255,255,0.06);padding:1px 5px;border-radius:6px;font-weight:700;border:1px solid var(--border) }
.kbd-row{display:flex;align-items:center;gap:6px;color:var(--muted)}

/* Footer fineprint */
.sidebar-footer{ margin-top:auto;padding-top:8px;border-top:1px dashed rgba(255,255,255,0.08) }
.fineprint{color:var(--muted);font-size:0.82rem;margin-top:6px}

/* Spinner */
.spinner{
  width:16px;height:16px;border-radius:50%;
  border:2px solid rgba(255,255,255,0.2); border-top-color:var(--accent);
  animation:spin 1s linear infinite;display:inline-block
}
@keyframes spin{to{transform:rotate(360deg)}}

/* Modal — compact */
.modal.hidden{ display:none }
.modal{ position:fixed; inset:0; z-index:1000 }
.modal-backdrop{ position:absolute; inset:0; background:rgba(0,0,0,0.45); backdrop-filter: blur(2px) }
.modal-dialog{
  position:relative; margin: 8vh auto 0 auto;
  width:min(560px, 92vw);
  background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow-2);
  color:var(--text);
}
.modal-header, .modal-footer{ display:flex; align-items:center; justify-content:space-between; padding:10px 12px }
.modal-body{ padding: 6px 12px 12px 12px }
.close-btn{ width:28px;height:28px }
.form-grid{ display:grid; grid-template-columns: 1fr; gap:10px }
.form-row{ display:flex; align-items:center; justify-content:space-between; gap:10px }
.form-row.switch{ justify-content:flex-start; gap:8px }
.form-row input[type="range"]{ width: 220px }
.modal-footer .btn{ min-width:110px }

/* Responsive */
@media (max-width:960px){
  .app{flex-direction:column; width:96vw; margin:12px auto}
  .sidebar{width:100%; position:static; max-height:none}
  .actions-col{gap:8px}
  #msgInput{ min-height:44px }
}